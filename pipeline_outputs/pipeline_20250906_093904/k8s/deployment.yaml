apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: devethops-pipeline
    component: model-serving
    pipeline: pipeline_20250906_093904
  name: devethops-pipeline
  namespace: devethops
spec:
  replicas: 2
  selector:
    matchLabels:
      app: devethops-pipeline
  template:
    metadata:
      labels:
        app: devethops-pipeline
        pipeline: pipeline_20250906_093904
    spec:
      containers:
      - env:
        - name: MODEL_PATH
          value: /app/model/model.joblib
        - name: PREPROCESSOR_PATH
          value: /app/model/preprocessor.joblib
        - name: PIPELINE_ID
          value: pipeline_20250906_093904
        image: devethops/model-server:latest
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
        name: model-server
        ports:
        - containerPort: 8000
          name: http
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /ready
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 500m
            memory: 1Gi
          requests:
            cpu: 250m
            memory: 512Mi
        startupProbe:
          failureThreshold: 30
          httpGet:
            path: /startup
            port: 8000
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 5
        volumeMounts:
        - mountPath: /app/model
          name: model-storage
      volumes:
      - configMap:
          name: devethops-pipeline-config
        name: model-storage
